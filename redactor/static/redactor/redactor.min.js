if(typeof RELANG==="undefined"){var RELANG={}}var RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",fullscreen:"Fullscreen",deleted:"Deleted",anchor:"Anchor"};(function(b){jQuery.fn.redactor=function(c){return this.each(function(){var e=b(this);var d=e.data("redactor");if(!d){e.data("redactor",(d=new a(this,c)))}})};var a=function(d,c){this.$el=b(d);if(typeof c!=="undefined"&&typeof c.lang!=="undefined"&&c.lang!=="en"&&typeof RELANG[c.lang]!=="undefined"){RLANG=RELANG[c.lang]}this.opts=b.extend({lang:"en",direction:"ltr",callback:false,keyupCallback:false,keydownCallback:false,execCommandCallback:false,path:false,css:"style.css",focus:false,resize:true,autoresize:false,fixed:false,autoformat:true,cleanUp:true,removeStyles:false,removeClasses:false,convertDivs:true,convertLinks:true,xhtml:false,handler:false,autosave:false,interval:60,imageGetJson:false,imageUpload:false,imageUploadCallback:false,fileUpload:false,fileUploadCallback:false,observeImages:true,visual:true,fullscreen:false,overlay:true,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignleft","aligncenter","alignright","justify","|","horizontalrule","fullscreen"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form>',modal_image_edit:String()+"<label>"+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_table:String()+"<label>"+RLANG.rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_video:String()+'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule},fullscreen:{title:RLANG.fullscreen,func:"fullscreen"}}},c,this.$el.data());this.dropdowns=[];this.init()};a.prototype={init:function(){this.getPath();if(this.opts.toolbar!==false){b.extend(this.opts.toolbar,this.opts.buttonsCustom);b.each(this.opts.buttonsAdd,b.proxy(function(d,e){this.opts.buttons.push(e)},this))}this.height=this.$el.css("height");this.width=this.$el.css("width");this.build();var c=this.$el.val();c=this.preformater(c);if(this.opts.autoformat){c=this.paragraphy(c)}this.$editor=this.enable(c);this.observeFocus();if(this.opts.cleanUp===true){b(this.doc).bind("paste",b.proxy(function(d){setTimeout(b.proxy(function(){var e=Math.floor(Math.random()*99999);var g="";if(b.browser.mozilla){g="&nbsp;"}var f=b('<span rel="pastemarkerend" id="pastemarkerend'+e+'">'+g+"</span>");this.insertNodeAtCaret(f.get(0));this.pasteCleanUp(e)},this),100)},this))}b(this.doc).keyup(b.proxy(function(f){var d=f.keyCode||f.which;if(typeof this.opts.keyupCallback==="function"){this.opts.keyupCallback(this,f)}if(this.opts.autoformat){if(d===8||d===46){return this.formatEmpty(f)}if(d===13&&!f.shiftKey&&!f.ctrlKey&&!f.metaKey){return this.formatNewLine(f)}}this.syncCode()},this));this.buildToolbar();if(this.opts.autoresize===false){this.buildResizer()}else{this.observeAutoResize()}this.shortcuts();this.autoSave();this.observeImages();this.observeTables();if(this.opts.fullscreen){this.opts.fullscreen=false;this.fullscreen()}if(this.opts.focus){this.focus()}if(this.opts.fixed){this.observeScroll();b(document).scroll(b.proxy(this.observeScroll,this))}if(typeof this.opts.callback==="function"){this.opts.callback(this)}},shortcuts:function(){b(this.doc).keydown(b.proxy(function(d){var c=d.keyCode||d.which;if(typeof this.opts.keydownCallback==="function"){this.opts.keydownCallback(this,d)}if(d.ctrlKey){if(c===90){this._shortcuts(d,"undo")}else{if(c===90&&d.shiftKey){this._shortcuts(d,"redo")}else{if(c===77){this._shortcuts(d,"removeFormat")}else{if(c===66){this._shortcuts(d,"bold")}else{if(c===73){this._shortcuts(d,"italic")}else{if(c===74){this._shortcuts(d,"insertunorderedlist")}else{if(c===75){this._shortcuts(d,"insertorderedlist")}else{if(c===76){this._shortcuts(d,"superscript")}else{if(c===72){this._shortcuts(d,"subscript")}}}}}}}}}}if(!d.shiftKey&&c===9){this._shortcuts(d,"indent")}else{if(d.shiftKey&&c===9){this._shortcuts(d,"outdent")}}if(b.browser.webkit&&navigator.userAgent.indexOf("Chrome")===-1){return this.safariShiftKeyEnter(d,c)}},this))},_shortcuts:function(d,c){if(d.preventDefault){d.preventDefault()}this.execCommand(c,false)},getPath:function(){if(this.opts.path!==false){return this.opts.path}b("script").each(b.proxy(function(c,d){if(d.src){var e=new RegExp(/\/redactor(\.min)?\.js(\?.*)?/);if(d.src.match(e)){this.opts.path=d.src.replace(e,"")}}},this))},build:function(){this.$box=b('<div class="redactor_box"></div>');this.$frame=b('<iframe frameborder="0" scrolling="auto" style="height: '+this.height+';" class="redactor_frame"></iframe>');this.$el.css("width","100%").hide();this.$box.insertAfter(this.$el).append(this.$frame).append(this.$el)},write:function(c){this.doc.open();this.doc.write(c);this.doc.close()},enable:function(c){this.doc=this.getDoc(this.$frame.get(0));if(this.doc!==null){this.write(this.setDoc(c));return b(this.doc).find("#page")}else{return false}},setDoc:function(d){var c='<!DOCTYPE html>\n<html><head><link media="all" type="text/css" href="'+this.opts.path+"/css/"+this.opts.css+'" rel="stylesheet"></head><body><div id="page" contenteditable="true" dir="'+this.opts.direction+'">'+d+"</div></body></html>";return c},getDoc:function(c){if(c.contentDocument){return c.contentDocument}else{if(c.contentWindow&&c.contentWindow.document){return c.contentWindow.document}else{if(c.document){return c.document}else{return null}}}},focus:function(){this.$editor.focus()},syncCode:function(){var c=this.formatting(this.$editor.html());this.$el.val(c)},setCode:function(c){c=this.preformater(c);this.$editor.html(c).focus();this.syncCode()},getCode:function(){var c=this.$editor?this.$editor.html():this.$el.val();c=this.reformater(c);return c},insertHtml:function(c){this.execCommand("inserthtml",c);this.observeImages()},destroy:function(){var d=this.getCode();this.$box.after(this.$el);this.$box.remove();this.$el.val(d).show();for(var c=0;c<this.dropdowns.length;c++){this.dropdowns[c].remove();delete (this.dropdowns[c])}},handler:function(){b.ajax({url:this.opts.handler,type:"POST",data:"redactor="+escape(encodeURIComponent(this.getCode())),success:b.proxy(function(c){this.setCode(c);this.syncCode()},this)})},observeFocus:function(){if(b.browser.msie){return false}if(b(this.doc).find("body").height()<b(this.$frame.get(0).contentWindow).height()){b(this.doc).click(b.proxy(function(c){this.$editor.focus()},this))}},observeImages:function(){if(this.opts.observeImages===false){return false}b(this.doc).find("img").each(b.proxy(function(c,d){if(b.browser.msie){b(d).attr("unselectable","on")}this.resizeImage(d)},this))},observeTables:function(){b(this.doc).find("body").find("table").click(b.proxy(this.tableObserver,this))},observeScroll:function(){var c=b(document).scrollTop();var d=this.$box.offset().top;if(c>d){this.fixed=true;this.$toolbar.css({position:"fixed",width:"100%"})}else{this.fixed=false;this.$toolbar.css({position:"relative",width:"auto"})}},observeAutoResize:function(){this.$editor.css({"min-height":this.$el.height()+"px"});b(this.doc).find("body").css({overflow:"hidden"});this.setAutoSize(false);b(this.doc).keyup(b.proxy(this.setAutoSize,this))},setAutoSize:function(f){var d=false;if(f!==false){d=f.keyCode||f.which}var c=this.$editor.outerHeight(true);if(f===true&&(d===8||d===46)){this.$frame.height(c)}else{this.$frame.height(c+30)}},execCommand:function(c,f){if(this.opts.visual&&this.doc){try{if(b.browser.msie){this.focus()}if(c==="inserthtml"&&b.browser.msie){this.doc.selection.createRange().pasteHTML(f)}else{if(c==="formatblock"&&b.browser.msie){this.doc.execCommand(c,false,"<"+f+">")}else{this.doc.execCommand(c,false,f)}}this.syncCode();this.focus();if(typeof this.opts.execCommandCallback==="function"){this.opts.execCommandCallback(this,c)}}catch(d){}}},formatNewLine:function(f){var d=this.getParentNode();if(d.nodeName==="DIV"&&d.id==="page"){if(f.preventDefault){f.preventDefault()}var c=b(this.getCurrentNode());if(c.get(0).tagName==="DIV"&&(c.html()===""||c.html()==="<br>")){var g=b("<p>").append(c.clone().get(0).childNodes);c.replaceWith(g);g.html("<br />");this.setFocusNode(g.get(0));this.syncCode();return false}else{this.syncCode()}if(this.opts.convertLinks){this.$editor.linkify()}}else{this.syncCode();return true}},safariShiftKeyEnter:function(f,d){if(f.shiftKey&&d===13){f.preventDefault();var c=b("<span><br /></span>");this.insertNodeAtCaret(c.get(0));this.setFocusNode(c.get(0));this.syncCode();return false}else{return true}},formatEmpty:function(g){var d=b.trim(this.$editor.html());if(b.browser.mozilla){d=d.replace(/<br>/gi,"")}if(d===""){if(g.preventDefault){g.preventDefault()}var c=this.opts.allEmptyHtml;if(b.browser.mozilla){c=this.opts.mozillaEmptyHtml}var f=b(c).get(0);this.$editor.html(f);this.setFocusNode(f);this.syncCode();return false}else{this.syncCode()}},paragraphy:function(e){e=b.trim(e);if(e===""){if(!b.browser.mozilla){return this.opts.allEmptyHtml}else{return this.opts.mozillaEmptyHtml}}if(this.opts.convertDivs){e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}var f=function(h,i,g){return h.replace(new RegExp(i,"g"),g)};var c=function(h,g){return f(e,h,g)};var d="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";e+="\n";c("<br />\\s*<br />","\n\n");c("(<"+d+"[^>]*>)","\n$1");c("(</"+d+">)","$1\n\n");c("\r\n|\r","\n");c("\n\n+","\n\n");c("\n?((.|\n)+?)$","<p>$1</p>\n");c("<p>\\s*?</p>","");c("<p>(<div[^>]*>\\s*)","$1<p>");c("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");c("<p>\\s*(</?"+d+"[^>]*>)\\s*</p>","$1");c("<p>(<li.+?)</p>","$1");c("<p>\\s*(</?"+d+"[^>]*>)","$1");c("(</?"+d+"[^>]*>)\\s*</p>","$1");c("(</?"+d+"[^>]*>)\\s*<br />","$1");c("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");if(e.indexOf("<pre")!=-1){c("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(j,i,h,g){return f(i,"\\\\(['\"\\\\])","$1")+f(f(f(g,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"})}return c("\n</p>$","</p>")},preformater:function(c){if(c!==null){c=c.replace(/<br>/gi,"<br />");c=c.replace(/<strong\b[^>]*>([\w\W]*?)<\/strong[^>]*>/gi,"<b>$1</b>");c=c.replace(/<em\b[^>]*>([\w\W]*?)<\/em[^>]*>/gi,"<i>$1</i>");c=c.replace(/<del\b[^>]*>([\w\W]*?)<\/del[^>]*>/gi,"<strike>$1</strike>")}else{c=""}return c},reformater:function(c){c=c.replace(/<br>/gi,"<br />");c=c.replace(/<b\b[^>]*>([\w\W]*?)<\/b[^>]*>/gi,"<strong>$1</strong>");c=c.replace(/<i\b[^>]*>([\w\W]*?)<\/i[^>]*>/gi,"<em>$1</em>");c=c.replace(/<strike\b[^>]*>([\w\W]*?)<\/strike[^>]*>/gi,"<del>$1</del>");c=c.replace(/<span(.*?)style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong>$2</strong>");c=c.replace(/<span(.*?)style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<em>$2</em>");c=c.replace(/<span(.*?)style="font-weight: bold; font-style: italic;">([\w\W]*?)<\/span>/gi,"<em><strong>$2</strong></em>");c=c.replace(/<span(.*?)style="font-style: italic; font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong><em>$2</em></strong>");return c},stripTags:function(d){var e=["code","span","div","label","a","br","p","b","i","del","strike","img","video","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"];var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return d.replace(c,function(g,f){return b.inArray(f.toLowerCase(),e)>"-1"?g:""})},cleanStyles:function(f,g,d){var c=d.split("=");var h=c[1].split(";");var e="";b.each(h,function(k,i){if(typeof i=="undefined"){return true}if(i=='"'||i=="'"){return true}i=i.replace(/(^"|^')/,"").replace(/("$|'$)/,"").replace(/"(.*?)"/gi,"");i=b.trim(i);var j=i.split(":");if(typeof j[1]!=="undefined"&&(j[1].search("pt")===-1&&j[1].search("cm")===-1)){if(b.inArray(b.trim(j[0]),f)!="-1"){e+=i+"; "}}});return g.replace(d,'style="'+e+'"')},pasteCleanUp:function(c){var f=this.$editor.html();f=f.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"");f=this.formattingRemove(f);f=this.stripTags(f);if(this.opts.removeClasses){f=f.replace(/ class="([\w\W]*?)"/gi,"")}else{f=f.replace(/\s*class="TOC(.*?)"/gi,"");f=f.replace(/\s*class="Heading(.*?)"/gi,"");f=f.replace(/\s*class="Body(.*?)"/gi,"");f=f.replace(/\sclass="Nonformat"/gi,"");f=f.replace(/\sclass="Mso(.*?)"/gi,"");f=f.replace(/\sclass="Apple(.*?)"/gi,"");f=f.replace(/"Times New Roman"/gi,"")}var d=["width","height","src","style","href","frameborder","class","id","rel","unselectable"];var e=["color","background-color","font-style","margin","margin-top","margin-bottom","margin-left","margin-right","text-align","width","height","cursor","float"];var h=f.match(/([\w\-.:]+)\s*=\s*("[^"]*"|'[^']*'|[\w\-.:]+)/gi);b.each(h,b.proxy(function(l,k){var j=k.split("=");if(b.inArray(j[0],d)=="-1"){f=f.replace(k,"")}if(this.opts.removeStyles===false&&j[0]=="style"){f=this.cleanStyles(e,f,k)}},this));if(this.opts.removeStyles===false){f=f.replace(/background-color:(\s+)transparent;\s/gi,"");f=f.replace(/font-style:(\s+)normal;\s/gi,"")}else{f=f.replace(/ style="([\w\W]*?)"/gi,"")}f=f.replace(/((\s{2,})?|\s)style=(""|'')/gi,"");f=f.replace(/(&nbsp;){1,}/gi,"&nbsp;");f=f.replace(/<span(\s)?>(\s)?<\/span>/gi," ");f=f.replace(/\s{2,}/g," ");f=f.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");f=f.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");f=f.replace(/<span(\s)?>([\w\W]*?)<\/span>/gi,"$2");f=this.formattingEmptyTags(f);f=this.formattingAddBefore(f);f=this.formattingAddAfter(f);f=this.formattingIndenting(f);f=f.replace(/<p><div>/gi,"");f=f.replace(/<p>\s+\n+<(.*?)/gi,"<$1");f=f.replace(/<\/(.*?)>\s+\n+<\/p>/gi,"</$1>");f=f.replace(/<p style="(.*?)">(\s)?<\/p>/gi,"");f=f.replace(/<p style="(.*?)"><\/p>/gi,"");f=f.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");f=f.replace(/; ">/gi,';">');this.$editor.html(f);var g=b(this.doc.body).find("#pastemarkerend"+c).get(0);this.setFocusNode(g);this.syncCode();setTimeout(b.proxy(function(){b(this.doc.body).find("span[rel=pastemarkerend]").remove();if(this.opts.autoresize===true){this.setAutoSize(false)}this.observeImages();this.observeTables()},this),100)},formattingRemove:function(c){c=c.replace(/\s{2,}/g," ");c=c.replace(/\n/g," ");c=c.replace(/[\t]*/g,"");c=c.replace(/\n\s*\n/g,"\n");c=c.replace(/^[\s\n]*/g,"");c=c.replace(/[\s\n]*$/g,"");c=c.replace(/>\s+</g,"><");return c},formattingIndenting:function(c){c=c.replace(/<li/g,"\t<li");c=c.replace(/<tr/g,"\t<tr");c=c.replace(/<td/g,"\t\t<td");c=c.replace(/<\/tr>/g,"\t</tr>");return c},formattingEmptyTags:function(f){var e=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var d=0;d<e.length;++d){var c=e[d];f=f.replace(new RegExp(c,"gi"),"")}return f},formattingAddBefore:function(e){var f="\r\n";var g=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var d=0;d<g.length;++d){var c=g[d];e=e.replace(new RegExp(c,"gi"),f+c)}return e},formattingAddAfter:function(e){var g="\r\n";var c=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var d=0;d<c.length;++d){var f=c[d];e=e.replace(new RegExp(f,"gi"),f+g)}return e},formatting:function(d){if(b.browser.msie){var c=d.match(/<(.*?)>/gi);b.each(c,function(e,f){d=d.replace(f,f.toLowerCase())});d=d.replace(/style="(.*?)"/gi,function(e){return e.toLowerCase()});d=d.replace(/ jQuery(.*?)=\"(.*?)\"/gi,"")}d=d.replace(/<span([\w\W]*?)style="color:(.*?);"><span([\w\W]*?)style="background-color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>');d=d.replace(/<span([\w\W]*?)style="background-color:(.*?);"><span([\w\W]*?)style="color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>');d=d.replace(/<span([\w\W]*?)color="(.*?)">([\w\W]*?)<\/span\>/gi,'<span$1style="color: $2;">$3</span>');d=d.replace(/<font([\w\W]*?)color="(.*?)">([\w\W]*?)<\/font\>/gi,'<span$1style="color: $2;">$3</span>');d=d.replace(/<span style="(.*?)"\s+style="(.*?)"[\s]*>([\w\W]*?)<\/span\>/gi,'<span style="$1;$2">$3</span>');d=d.replace(/<font([\w\W]*?)>([\w\W]*?)<\/font\>/gi,"<span$1>$2</span>");d=d.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");if(this.opts.xhtml){d=d.replace(/<br>/gi,"<br />");d=d.replace(/<br ?\/?>$/gi,"");d=d.replace(/^<br ?\/?>/gi,"");d=d.replace(/(<img [^>]+[^\/])>/gi,"$1 />")}d=d.replace(/<p><p>/g,"<p>");d=d.replace(/<\/p><\/p>/g,"</p>");d=d.replace(/<hr(.*?)>/g,"<hr />");d=d.replace(/<p>&nbsp;/g,"<p>");d=d.replace(/<p><ul>/g,"<ul>");d=d.replace(/<p><ol>/g,"<ol>");d=d.replace(/<\/ul><\/p>/g,"</ul>");d=d.replace(/<\/ol><\/p>/g,"</ol>");d=d.replace(/<p(.*?)>&nbsp;<\/p>/gi,"");d=this.formattingRemove(d);d=this.formattingEmptyTags(d);d=this.formattingAddBefore(d);d=this.formattingAddAfter(d);d=this.formattingIndenting(d);return d},toggle:function(){var c;if(this.opts.visual){this.$frame.hide();c=this.$editor.html();c=b.trim(this.formatting(c));this.$el.val(c).show().focus();this.setBtnActive("html");this.opts.visual=false}else{this.$el.hide();this.$editor.html(this.$el.val());this.$frame.show();if(this.$editor.html()===""){if(!b.browser.mozilla){c=this.opts.allEmptyHtml}else{c=this.opts.mozillaEmptyHtml}this.setCode(c)}this.focus();this.setBtnInactive("html");this.opts.visual=true;this.observeImages();this.observeTables();if(this.opts.autoresize===true){this.setAutoSize(false)}}},autoSave:function(){if(this.opts.autosave===false){return false}setInterval(b.proxy(function(){b.post(this.opts.autosave,{data:this.getCode()})},this),this.opts.interval*1000)},buildToolbar:function(){if(this.opts.toolbar===false){return false}this.$toolbar=b("<ul>").addClass("redactor_toolbar");this.$box.prepend(this.$toolbar);b.each(this.opts.buttons,b.proxy(function(f,e){if(e!=="|"&&typeof this.opts.toolbar[e]!=="undefined"){var g=this.opts.toolbar[e];if(this.opts.fileUpload===false&&e==="file"){return true}var c=b("<li>");if(e==="fullscreen"){b(c).addClass("redactor_toolbar_right")}var d=this.buildButton(e,g);if(e==="backcolor"||e==="fontcolor"||typeof(g.dropdown)!=="undefined"){var h=b('<div class="redactor_dropdown" style="display: none;">');if(e==="backcolor"||e==="fontcolor"){h=this.buildColorPicker(h,e)}else{h=this.buildDropdown(h,g.dropdown)}this.dropdowns.push(h.appendTo(b(document.body)));this.hdlHideDropDown=b.proxy(function(i){this.hideDropDown(i,h,e)},this);this.hdlShowDropDown=b.proxy(function(i){this.showDropDown(i,h,e)},this);d.click(this.hdlShowDropDown)}this.$toolbar.append(b(c).append(d))}if(e==="|"){this.$toolbar.append(b('<li class="redactor_separator"></li>'))}},this));b(document).click(this.hdlHideDropDown);b(this.doc).click(this.hdlHideDropDown)},buildButton:function(d,e){var c=b('<a href="javascript:void(null);" title="'+e.title+'" class="redactor_btn_'+d+'"><span>&nbsp;</span></a>');if(typeof e.func==="undefined"){c.click(b.proxy(function(){this.execCommand(e.exec,d)},this))}else{if(e.func!=="show"){c.click(b.proxy(function(f){this[e.func](f)},this))}}if(typeof e.callback!=="undefined"){c.click(b.proxy(function(f){e.callback(this,f,d)},this))}return c},buildDropdown:function(d,c){b.each(c,b.proxy(function(e,g){if(typeof(g.className)==="undefined"){g.className=""}var f;if(typeof g.name!=="undefined"&&g.name==="separator"){f=b('<a class="redactor_separator_drop">')}else{f=b('<a href="javascript:void(null);" class="'+g.className+'">'+g.title+"</a>");if(typeof(g.func)==="undefined"){b(f).click(b.proxy(function(){this.execCommand(g.exec,e)},this))}else{b(f).click(b.proxy(function(h){this[g.func](h)},this))}}b(d).append(f)},this));return d},buildColorPicker:function(l,k){var f;if(k==="backcolor"){if(b.browser.msie){f="BackColor"}else{f="hilitecolor"}}else{f="forecolor"}b(l).width(210);var g=this.opts.colors.length;for(var e=0;e<g;++e){var c=this.opts.colors[e];var j=b('<a rel="'+c+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:c});b(l).append(j);var h=this;b(j).click(function(){h.execCommand(f,b(this).attr("rel"))})}var d=b('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);if(k==="backcolor"){d.click(b.proxy(this.setBackgroundNone,this))}else{d.click(b.proxy(this.setColorNone,this))}b(l).append(d);return l},setBackgroundNone:function(){b(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){b(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(g,h,c){if(this.getBtn(c).hasClass("dropact")){this.hideAllDropDown()}else{this.hideAllDropDown();this.setBtnActive(c);this.getBtn(c).addClass("dropact");var f=this.getBtn(c).offset().left;if(this.opts.fixed&&this.fixed){b(h).css({position:"fixed",left:f+"px",top:"30px"}).show()}else{var d=this.$toolbar.offset().top+30;b(h).css({position:"absolute",left:f+"px",top:d+"px"}).show()}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact");b(".redactor_dropdown").hide()},hideDropDown:function(d,f,c){if(!b(d.target).parent().hasClass("dropact")){b(f).removeClass("act");this.showedDropDown=false;this.hideAllDropDown()}},getSelection:function(){if(this.$frame.get(0).contentWindow.getSelection){return this.$frame.get(0).contentWindow.getSelection()}else{if(this.$frame.get(0).contentWindow.document.selection){return this.$frame.get(0).contentWindow.document.selection.createRange()}}},getParentNode:function(){if(window.getSelection){return this.getSelection().getRangeAt(0).startContainer.parentNode}else{if(document.selection){return this.getSelection().parentElement()}}},getCurrentNode:function(){if(window.getSelection){return this.getSelection().getRangeAt(0).startContainer}else{if(document.selection){return this.getSelection()}}},setFocusNode:function(f,d){var c=this.doc.createRange();var e=this.getSelection();d=d?0:1;if(e!==null){c.selectNodeContents(f);e.addRange(c);e.collapse(f,d)}this.focus()},insertNodeAtCaret:function(g){if(typeof window.getSelection!=="undefined"){var h=this.getSelection();if(h.rangeCount){var d=h.getRangeAt(0);d.collapse(false);d.insertNode(g);d=d.cloneRange();d.selectNodeContents(g);d.collapse(false);h.removeAllRanges();h.addRange(d)}}else{if(typeof document.selection!=="undefined"&&document.selection.type!=="Control"){var e=(g.nodeType===1)?g.outerHTML:g.data;var i="marker_"+(""+Math.random()).slice(2);e+='<span id="'+i+'"></span>';var f=this.getSelection();f.collapse(false);f.pasteHTML(e);var c=document.getElementById(i);f.moveToElementText(c);f.select();c.parentNode.removeChild(c)}}},getBtn:function(c){return b(this.$toolbar.find("a.redactor_btn_"+c))},setBtnActive:function(c){this.getBtn(c).addClass("act")},setBtnInactive:function(c){this.getBtn(c).removeClass("act")},changeBtnIcon:function(c,d){this.getBtn(c).addClass("redactor_btn_"+d)},removeBtnIcon:function(c,d){this.getBtn(c).removeClass("redactor_btn_"+d)},removeBtn:function(c){this.getBtn(c).remove()},addBtn:function(c,d){this.$toolbar.append(b("<li>").append(this.buildButton(c,d)))},fullscreen:function(){var c;if(this.opts.fullscreen===false){this.changeBtnIcon("fullscreen","normalscreen");this.setBtnActive("fullscreen");this.opts.fullscreen=true;this.height=this.$frame.css("height");this.width=(this.$box.width()-2)+"px";c=this.getCode();this.tmpspan=b("<span></span>");this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan);b(document.body).prepend(this.$box).css("overflow","hidden");this.$editor=this.enable(c);b(this.doc).click(b.proxy(this.hideAllDropDown,this));this.observeFocus();this.observeImages();this.observeTables();this.$box.find(".redactor_resizer").hide();this.fullScreenResize();b(window).resize(b.proxy(this.fullScreenResize,this));b(document).scrollTop(0,0);this.focus()}else{this.removeBtnIcon("fullscreen","normalscreen");this.setBtnInactive("fullscreen");this.opts.fullscreen=false;b(window).unbind("resize",b.proxy(this.fullScreenResize,this));b(document.body).css("overflow","");c=this.getCode();this.$box.removeClass("redactor_box_fullscreen").css("width","auto");this.tmpspan.after(this.$box).remove();this.$editor=this.enable(c);this.observeImages();this.observeTables();if(this.opts.autoresize){this.observeAutoResize()}this.$box.find(".redactor_resizer").show();b(this.doc).click(b.proxy(this.hideAllDropDown,this));this.observeFocus();this.syncCode();this.$frame.css("height",this.height);this.$el.css("height",this.height);this.focus()}},fullScreenResize:function(){if(this.opts.fullscreen===false){return false}var c=b(window).height()-42;this.$box.width(b(window).width()-2);this.$frame.height(c);this.$el.height(c)},buildResizer:function(){if(this.opts.resize===false){return false}this.$resizer=b('<div class="redactor_resizer">&mdash;</div>');this.$box.append(this.$resizer);this.$resizer.mousedown(b.proxy(this.initResize,this))},initResize:function(c){if(c.preventDefault){c.preventDefault()}this.splitter=c.target;if(this.opts.visual){this.element_resize=this.$frame;this.element_resize.get(0).style.visibility="hidden";this.element_resize_parent=this.$el}else{this.element_resize=this.$el;this.element_resize_parent=this.$frame}this.stopResizeHdl=b.proxy(this.stopResize,this);this.startResizeHdl=b.proxy(this.startResize,this);this.resizeHdl=b.proxy(this.resize,this);b(document).mousedown(this.startResizeHdl);b(document).mouseup(this.stopResizeHdl);b(this.splitter).mouseup(this.stopResizeHdl);this.null_point=false;this.h_new=false;this.h=this.element_resize.height()},startResize:function(){b(document).mousemove(this.resizeHdl)},resize:function(d){if(d.preventDefault){d.preventDefault()}var f=d.pageY;if(this.null_point===false){this.null_point=f}if(this.h_new===false){this.h_new=this.element_resize.height()}var c=(this.h_new+f-this.null_point)-10;if(c<=30){return true}if(c>=0){this.element_resize.get(0).style.height=c+"px";this.element_resize_parent.get(0).style.height=c+"px"}},stopResize:function(c){b(document).unbind("mousemove",this.resizeHdl);b(document).unbind("mousedown",this.startResizeHdl);b(document).unbind("mouseup",this.stopResizeHdl);b(this.splitter).unbind("mouseup",this.stopResizeHdl);this.element_resize.get(0).style.visibility="visible"},resizeImage:function(d){var g=false;var c=false;var l;var k;var f=b(d).width()/b(d).height();var h=1;var i=1;var j=1;var e=1;b(d).hover(function(){b(d).css("cursor","nw-resize")},function(){b(d).css("cursor","default");g=false});b(d).mousedown(function(m){if(m.preventDefault){m.preventDefault()}g=true;c=true;l=Math.round(m.pageX-b(d).eq(0).offset().left);k=Math.round(m.pageY-b(d).eq(0).offset().top)});b(d).mouseup(b.proxy(function(m){g=false;this.syncCode();if(this.opts.autoresize===true){this.setAutoSize(false)}},this));b(d).click(b.proxy(function(m){if(c){this.imageEdit(m)}},this));b(d).mousemove(function(q){if(g){c=false;var n=Math.round(q.pageX-b(this).eq(0).offset().left)-l;var m=Math.round(q.pageY-b(this).eq(0).offset().top)-k;var p=b(d).height();var r=parseInt(p,10)+m;var o=r*f;if(i===1||(typeof(i)==="number"&&o<i&&o>j)){b(d).width(o)}if(h===1||(typeof(h)==="number"&&r<h&&r>e)){b(d).height(r)}l=Math.round(q.pageX-b(this).eq(0).offset().left);k=Math.round(q.pageY-b(this).eq(0).offset().top)}})},showTable:function(){this.modalInit(RLANG.table,"table",300,b.proxy(function(){b("#redactor_insert_table_btn").click(b.proxy(this.insertTable,this))},this),function(){b("#redactor_table_rows").focus()})},insertTable:function(){var m=b("#redactor_table_rows").val();var f=b("#redactor_table_columns").val();var c=b("<div></div>");var d=Math.floor(Math.random()*99999);var k=b('<table id="table'+d+'"><tbody></tbody></table>');for(var g=0;g<m;g++){var l=b("<tr></tr>");for(var j=0;j<f;j++){var e=b("<td>&nbsp;</td>");b(l).append(e)}b(k).append(l)}b(c).append(k);var h=b(c).html();if(b.browser.msie){h+="<p></p>"}else{h+="<p>&nbsp;</p>"}this.execCommand("inserthtml",h);this.modalClose();this.$table=b(this.doc).find("body").find("#table"+d);this.$table.click(b.proxy(this.tableObserver,this));if(this.opts.autoresize===true){this.setAutoSize(false)}},tableObserver:function(c){this.$table=b(c.target).parents("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$table_td.removeClass("current");this.$tbody=b(c.target).parents("tbody");this.$thead=b(this.$table).find("thead");this.$current_td=b(c.target);this.$current_td.addClass("current");this.$current_tr=b(c.target).parents("tr")},deleteTable:function(){b(this.$table).remove();this.$table=false;this.syncCode()},deleteRow:function(){b(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var c=b(this.$current_td).get(0).cellIndex;b(this.$table).find("tr").each(function(){b(this).find("td").eq(c).remove()});this.syncCode()},addHead:function(){if(b(this.$table).find("thead").size()!==0){this.deleteHead()}else{var c=b(this.$table).find("tr").first().clone();c.find("td").html("&nbsp;");this.$thead=b("<thead></thead>");this.$thead.append(c);b(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){b(this.$thead).remove();this.$thead=false;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(c){var d=b(this.$current_tr).clone();d.find("td").html("&nbsp;");if(c==="after"){b(this.$current_tr).after(d)}else{b(this.$current_tr).before(d)}this.syncCode()},insertColumn:function(d){var c=0;this.$current_td.addClass("current");this.$current_tr.find("td").each(function(e,f){if(b(f).hasClass("current")){c=e}});this.$table_tr.each(function(e,f){var g=b(f).find("td").eq(c);var h=g.clone();h.html("&nbsp;");if(d==="after"){b(g).after(h)}else{b(g).before(h)}});this.syncCode()},showVideo:function(){if(b.browser.msie){this.markerIE()}this.modalInit(RLANG.video,"video",600,b.proxy(function(){b("#redactor_insert_video_btn").click(b.proxy(this.insertVideo,this))},this),function(){b("#redactor_insert_video_area").focus()})},insertVideo:function(){var c=b("#redactor_insert_video_area").val();c=this.stripTags(c);if(b.browser.msie){b(this.doc.getElementById("span"+this.spanid)).after(c).remove();this.syncCode()}else{this.execCommand("inserthtml",c)}this.modalClose();if(this.opts.autoresize===true){this.setAutoSize(false)}},imageEdit:function(g){var c=b(g.target);var f=c.parent();var d=b.proxy(function(){b("#redactor_file_alt").val(c.attr("alt"));b("#redactor_image_edit_src").attr("href",c.attr("src"));b("#redactor_form_image_align").val(c.css("float"));if(b(f).get(0).tagName==="A"){b("#redactor_file_link").val(b(f).attr("href"))}b("#redactor_image_delete_btn").click(b.proxy(function(){this.imageDelete(c)},this));b("#redactorSaveBtn").click(b.proxy(function(){this.imageSave(c)},this))},this);this.modalInit(RLANG.image,"image_edit",380,d)},imageDelete:function(c){b(c).remove();this.modalClose();this.syncCode();if(this.opts.autoresize===true){this.setAutoSize(false)}},imageSave:function(d){var c=b(d).parent();b(d).attr("alt",b("#redactor_file_alt").val());var f=b("#redactor_form_image_align").val();if(f==="left"){b(d).css({"float":"left",margin:"0 10px 10px 0"})}else{if(f==="right"){b(d).css({"float":"right",margin:"0 0 10px 10px"})}else{b(d).css({"float":"none",margin:"0"})}}var e=b.trim(b("#redactor_file_link").val());if(e!==""){if(b(c).get(0).tagName!=="A"){b(d).replaceWith('<a href="'+e+'">'+this.outerHTML(d)+"</a>")}else{b(c).attr("href",e)}}else{if(b(c).get(0).tagName==="A"){b(c).replaceWith(this.outerHTML(d))}}this.modalClose();this.observeImages();this.syncCode()},showImage:function(){if(b.browser.msie){this.markerIE()}var c=b.proxy(function(){if(this.opts.imageGetJson!==false){b.getJSON(this.opts.imageGetJson,b.proxy(function(f){b.each(f,b.proxy(function(h,i){var g=b('<img src="'+i.thumb+'" rel="'+i.image+'" />');b("#redactor_image_box").append(g);b(g).click(b.proxy(this.imageSetThumb,this))},this))},this))}else{b("#redactor_tabs a").eq(1).remove()}if(this.opts.imageUpload!==false){if(this.isMobile()===false){if(b("#redactor_file").size()!==0){b("#redactor_file").dragupload({url:this.opts.imageUpload,success:b.proxy(this.imageUploadCallback,this)})}}this.uploadInit("redactor_file",{auto:true,url:this.opts.imageUpload,success:b.proxy(this.imageUploadCallback,this)})}else{b(".redactor_tab").hide();if(this.opts.imageGetJson===false){b("#redactor_tabs").remove();b("#redactor_tab3").show()}else{var e=b("#redactor_tabs a");e.eq(0).remove();e.eq(1).addClass("redactor_tabs_act");b("#redactor_tab2").show()}}b("#redactor_upload_btn").click(b.proxy(this.imageUploadCallbackLink,this))},this);var d=b.proxy(function(){if(this.opts.imageUpload===false&&this.opts.imageGetJson===false){b("#redactor_file_link").focus()}},this);this.modalInit(RLANG.image,"image",570,c,d,true)},imageSetThumb:function(c){this._imageSet('<img alt="" src="'+b(c.target).attr("rel")+'" />',true)},imageUploadCallbackLink:function(){if(b("#redactor_file_link").val()!==""){var c='<img src="'+b("#redactor_file_link").val()+'" />';this._imageSet(c,true)}else{this.modalClose()}},imageUploadCallback:function(c){this._imageSet(c)},_imageSet:function(d,e){var c="",f="";if(e!==true){f=b.parseJSON(d);c='<p><img src="'+f.filelink+'" /></p>'}else{c=d}this.focus();if(b.browser.msie){b(this.doc.getElementById("span"+this.spanid)).after(c).remove();this.syncCode()}else{this.execCommand("inserthtml",c)}if(e!==true&&typeof this.opts.imageUploadCallback==="function"){this.opts.imageUploadCallback(this,f)}this.modalClose();b(this.doc).find("img").load(b.proxy(function(){this.setAutoSize(false)},this));this.observeImages()},showLink:function(){var c=b.proxy(function(){var i=this.getSelection();var e="",j="";if(b.browser.msie){var g=this.getParentNode();if(g.nodeName==="A"){this.insert_link_node=b(g);j=this.insert_link_node.text();e=this.insert_link_node.attr("href")}else{if(this.oldIE()){j=i.text}else{j=i.toString()}this.spanid=Math.floor(Math.random()*99999);var f='<span id="span'+this.spanid+'">'+j+"</span>";if(j!==""){f='<span id="span'+this.spanid+'">'+j+"</span>"}this.execCommand("inserthtml",f)}}else{if(i&&i.anchorNode&&i.anchorNode.parentNode.tagName==="A"){e=i.anchorNode.parentNode.href;j=i.anchorNode.parentNode.text;if(i.toString()===""){this.insert_link_node=i.anchorNode.parentNode}}else{j=i.toString();e=""}}b(".redactor_link_text").val(j);var h=e.replace(top.location.href,"");if(e.search("mailto:")===0){this.setModalTab(2);b("#redactor_tab_selected").val(2);b("#redactor_link_mailto").val(e.replace("mailto:",""))}else{if(h.search(/^#/gi)===0){this.setModalTab(3);b("#redactor_tab_selected").val(3);b("#redactor_link_anchor").val(h.replace(/^#/gi,""))}else{b("#redactor_link_url").val(e)}}b("#redactor_insert_link_btn").click(b.proxy(this.insertLink,this))},this);var d=function(e){b("#redactor_link_url").focus()};this.modalInit(RLANG.link,"link",460,c,d)},insertLink:function(){var d=b("#redactor_tab_selected").val();var c="",e="";if(d==="1"){c=b("#redactor_link_url").val();e=b("#redactor_link_url_text").val()}else{if(d==="2"){c="mailto:"+b("#redactor_link_mailto").val();e=b("#redactor_link_mailto_text").val()}else{if(d==="3"){c="#"+b("#redactor_link_anchor").val();e=b("#redactor_link_anchor_text").val()}}}this._insertLink('<a href="'+c+'">'+e+"</a> ",b.trim(e),c)},_insertLink:function(c,e,d){if(e!=""){if(this.insert_link_node){b(this.insert_link_node).text(e);b(this.insert_link_node).attr("href",d);this.syncCode()}else{if(b.browser.msie){b(this.doc.getElementById("span"+this.spanid)).replaceWith(c);this.syncCode()}else{this.execCommand("inserthtml",c)}}}this.modalClose()},showFile:function(){if(b.browser.msie){this.markerIE()}var c=b.proxy(function(){var d=this.getSelection();var e="";if(this.oldIE()){e=d.text}else{e=d.toString()}b("#redactor_filename").val(e);if(this.isMobile()===false){b("#redactor_file").dragupload({url:this.opts.fileUpload,success:b.proxy(function(f){this.fileUploadCallback(f)},this)})}this.uploadInit("redactor_file",{auto:true,url:this.opts.fileUpload,success:b.proxy(function(f){this.fileUploadCallback(f)},this)})},this);this.modalInit(RLANG.file,"file",500,c)},fileUploadCallback:function(c){var e=b.parseJSON(c);var f=b("#redactor_filename").val();if(f===""){f=e.filename}var d='<a href="'+e.filelink+'">'+f+"</a>";if(b.browser.webkit&&!!window.chrome){d=d+"&nbsp;"}if(b.browser.msie){if(f!==""){b(this.doc.getElementById("span"+this.spanid)).replaceWith(d)}else{b(this.doc.getElementById("span"+this.spanid)).after(d).remove()}this.syncCode()}else{this.execCommand("inserthtml",d)}if(typeof this.opts.fileUploadCallback==="function"){this.opts.fileUploadCallback(this,e)}this.modalClose()},modalInit:function(j,e,g,f,i,d){if(b("#redactor_modal_overlay").size()===0){this.overlay=b('<div id="redactor_modal_overlay" style="display: none;"></div>');b("body").prepend(this.overlay)}if(this.opts.overlay){b("#redactor_modal_overlay").show();b("#redactor_modal_overlay").click(b.proxy(this.modalClose,this))}if(b("#redactor_modal").size()===0){this.modal=b('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>');b("body").append(this.modal)}b("#redactor_modal_close").click(b.proxy(this.modalClose,this));this.hdlModalClose=b.proxy(function(k){if(k.keyCode===27){this.modalClose()}},this);b(document).keyup(this.hdlModalClose);b(this.doc).keyup(this.hdlModalClose);b("#redactor_modal_inner").html(this.opts["modal_"+e]);b("#redactor_modal_header").html(j);if(b("#redactor_tabs").size()!==0){var h=this;b("#redactor_tabs a").each(function(k,l){k++;b(l).click(function(){b("#redactor_tabs a").removeClass("redactor_tabs_act");b(this).addClass("redactor_tabs_act");b(".redactor_tab").hide();b("#redactor_tab"+k).show();b("#redactor_tab_selected").val(k);if(h.isMobile()===false){var m=b("#redactor_modal").outerHeight();b("#redactor_modal").css("margin-top","-"+(m+10)/2+"px")}})})}b("#redactor_btn_modal_close").click(b.proxy(this.modalClose,this));if(typeof(f)==="function"){f()}var c=b("#redactor_modal").outerHeight();if(this.isMobile()===false){b("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:g+"px",height:"auto",marginTop:"-"+(c+10)/2+"px",marginLeft:"-"+(g+60)/2+"px"}).fadeIn("fast")}else{b("#redactor_modal").css({position:"absolute",width:"96%",height:"auto",top:"20px",left:"0",marginTop:"0px",marginLeft:"2%"}).show();this.scrolltop()}if(typeof(i)==="function"){i()}if(d===true){b("#redactor_image_box").height(300).css("overflow","auto")}},modalClose:function(){b("#redactor_modal_close").unbind("click",this.modalClose);b("#redactor_modal").fadeOut("fast",b.proxy(function(){b("#redactor_modal_inner").html("");if(this.opts.overlay){b("#redactor_modal_overlay").hide();b("#redactor_modal_overlay").unbind("click",this.modalClose)}b(document).unbind("keyup",this.hdlModalClose);b(this.doc).unbind("keyup",this.hdlModalClose)},this))},setModalTab:function(c){b(".redactor_tab").hide();var d=b("#redactor_tabs a");d.removeClass("redactor_tabs_act");d.eq(c-1).addClass("redactor_tabs_act");b("#redactor_tab"+c).show()},uploadInit:function(d,c){this.uploadOptions={url:false,success:false,start:false,trigger:false,auto:false,input:false};b.extend(this.uploadOptions,c);if(b("#"+d).size()!==0&&b("#"+d).get(0).tagName==="INPUT"){this.uploadOptions.input=b("#"+d);this.element=b(b("#"+d).get(0).form)}else{this.element=b("#"+d)}this.element_action=this.element.attr("action");if(this.uploadOptions.auto){b(this.uploadOptions.input).change(b.proxy(function(){this.element.submit(function(f){return false});this.uploadSubmit()},this))}else{if(this.uploadOptions.trigger){b("#"+this.uploadOptions.trigger).click(b.proxy(this.uploadSubmit,this))}}},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var e=document.createElement("div");var c='<iframe style="display:none" src="about:blank" id="'+this.id+'" name="'+this.id+'"></iframe>';e.innerHTML=c;document.body.appendChild(e);if(this.uploadOptions.start){this.uploadOptions.start()}b("#"+this.id).load(b.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(g,e){if(this.uploadOptions.input){var h="redactorUploadForm"+this.id;var c="redactorUploadFile"+this.id;this.form=b('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+e+'" name="'+h+'" id="'+h+'" enctype="multipart/form-data"></form>');var d=this.uploadOptions.input;var i=b(d).clone();b(d).attr("id",c);b(d).before(i);b(d).appendTo(this.form);b(this.form).css("position","absolute");b(this.form).css("top","-2000px");b(this.form).css("left","-2000px");b(this.form).appendTo("body");this.form.submit()}else{g.attr("target",e);g.attr("method","POST");g.attr("enctype","multipart/form-data");g.attr("action",this.uploadOptions.url);this.element.submit()}},uploadLoaded:function(){var f=b("#"+this.id);var g;if(f.contentDocument){g=f.contentDocument}else{if(f.contentWindow){g=f.contentWindow.document}else{g=window.frames[this.id].document}}if(g.location.href==="about:blank"){return true}if(this.uploadOptions.success){var e=g.body.innerHTML;var c=e.match(/\{.*\}/)[0];this.uploadOptions.success(c)}this.element.attr("action",this.element_action);this.element.attr("target","")},markerIE:function(){this.spanid=Math.floor(Math.random()*99999);this.execCommand("inserthtml",'<span id="span'+this.spanid+'"></span>')},oldIE:function(){if(b.browser.msie&&parseInt(b.browser.version,10)<9){return true}return false},outerHTML:function(c){return b("<p>").append(b(c).eq(0).clone()).html()},normalize:function(c){return parseInt(c.replace("px",""),10)},isMobile:function(){if(/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{return false}},scrolltop:function(){b("html,body").animate({scrollTop:0},500)}};b.fn.getDoc=function(){return b(this.data("redactor").doc)};b.fn.getFrame=function(){return this.data("redactor").$frame};b.fn.getEditor=function(){return this.data("redactor").$editor};b.fn.getCode=function(){return this.data("redactor").getCode()};b.fn.getText=function(){return this.data("redactor").$editor.text()};b.fn.setCode=function(c){this.data("redactor").setCode(c)};b.fn.insertHtml=function(c){this.data("redactor").insertHtml(c)};b.fn.destroyEditor=function(){this.data("redactor").destroy();this.removeData("redactor")};b.fn.setFocus=function(){this.data("redactor").focus()};b.fn.execCommand=function(c,d){this.data("redactor").execCommand(c,d)}})(jQuery);(function(b){b.fn.dragupload=function(c){return this.each(function(){var d=new a(this,c);d.init()})};function a(d,c){this.opts=b.extend({url:false,success:false,preview:false,text:RLANG.drop_file_here,atext:RLANG.or_choose},c);this.$el=b(d)}a.prototype={init:function(){if(!b.browser.opera&&!b.browser.msie){this.droparea=b('<div class="redactor_droparea"></div>');this.dropareabox=b('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=b('<div class="redactor_dropalternative">'+this.opts.atext+"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",b.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",b.proxy(function(){return this.ondragleave()},this));var e=b.proxy(function(g){var f=parseInt(g.loaded/g.total*100,10);this.dropareabox.text("Loading "+f+"%")},this);var d=jQuery.ajaxSettings.xhr();if(d.upload){d.upload.addEventListener("progress",e,false)}var c=function(){return d};this.dropareabox.get(0).ondrop=b.proxy(function(h){h.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");var g=h.dataTransfer.files[0];var f=new FormData();f.append("file",g);b.ajax({dataType:"html",url:this.opts.url,data:f,xhr:c,cache:false,contentType:false,processData:false,type:"POST",success:b.proxy(function(i){if(this.opts.success!==false){this.opts.success(i)}if(this.opts.preview===true){this.dropareabox.html(i)}},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return false},ondragleave:function(){this.dropareabox.removeClass("hover");return false}}})(jQuery);(function(b){var d=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,a=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,c=function(){var g=this.childNodes,f=g.length;while(f--){var h=g[f];if(h.nodeType===3){var e=h.nodeValue;if(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(d,'$1<a href="http://$2">$2</a>$3').replace(a,'$1<a href="$2">$2</a>$5');b(h).after(e).remove()}}else{if(h.nodeType===1&&!/^(a|button|textarea)$/i.test(h.tagName)){c.call(h)}}}};b.fn.linkify=function(){this.each(c)}})(jQuery);